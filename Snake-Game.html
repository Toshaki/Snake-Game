<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game</title>

<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
    margin: 0;
    height: 100vh;
  }

  canvas {
    background: black;
    border: 2px solid white;
    display: none;
    touch-action: none;
  }

  #playButton {
    padding: 15px 30px;
    font-size: 20px;
    margin-bottom: 20px;
    cursor: pointer;
    background: #9d4edd;
    border: none;
    border-radius: 5px;
    color: black;
    font-weight: bold;
  }

  video {
    display: none;
    width: 80%;
    margin-top: 20px;
  }
</style>
</head>

<body>

<h2>Snake Game</h2>
<button id="playButton">Play Game</button>

<canvas id="game"></canvas>

<video id="loseVideo" controls></video>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const video = document.getElementById("loseVideo");
const playButton = document.getElementById("playButton");

let snake, direction, food, game, box;
let touchStartX = 0, touchStartY = 0;

// RANDOM LOSE VIDEOS
const loseVideos = [
  "take_a_chance.mp4",
  "ere.mp4",
  "nandito_ako.mp4",
  "torete.mp4",
  "ikaw_at_ako.mp4",
  "kalapastangan.mp4",
  "tala.mp4"
];

playButton.addEventListener("click", startGame);

function startGame() {
  playButton.style.display = "none";
  video.style.display = "none";
  canvas.style.display = "block";
  initGame();
}

function initGame() {
  box = 20;
  canvas.width = Math.min(400, window.innerWidth - 40);
  canvas.height = canvas.width;

  snake = [{ x: 5 * box, y: 5 * box }];
  direction = "RIGHT";

  food = {
    x: Math.floor(Math.random() * (canvas.width / box)) * box,
    y: Math.floor(Math.random() * (canvas.height / box)) * box
  };

  document.addEventListener("keydown", changeDirection);

  document.addEventListener("touchstart", e => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });

  document.addEventListener("touchend", e => {
    let dx = e.changedTouches[0].clientX - touchStartX;
    let dy = e.changedTouches[0].clientY - touchStartY;

    if (Math.abs(dx) > Math.abs(dy)) {
      if (dx > 0 && direction !== "LEFT") direction = "RIGHT";
      else if (dx < 0 && direction !== "RIGHT") direction = "LEFT";
    } else {
      if (dy > 0 && direction !== "UP") direction = "DOWN";
      else if (dy < 0 && direction !== "DOWN") direction = "UP";
    }
  });

  clearInterval(game);
  game = setInterval(draw, 200); // SLOW SPEED
}

function changeDirection(e) {
  const key = e.key.toLowerCase();

  if ((key === "arrowleft" || key === "a") && direction !== "RIGHT") direction = "LEFT";
  else if ((key === "arrowup" || key === "w") && direction !== "DOWN") direction = "UP";
  else if ((key === "arrowright" || key === "d") && direction !== "LEFT") direction = "RIGHT";
  else if ((key === "arrowdown" || key === "s") && direction !== "UP") direction = "DOWN";
}

function collision(head, body) {
  return body.some(part => part.x === head.x && part.y === head.y);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ðŸ’œ PURPLE GLOW
  ctx.shadowBlur = 15;
  ctx.shadowColor = "#c77dff";

  // Snake
  snake.forEach((part, index) => {
    ctx.fillStyle = index === 0 ? "#e0aaff" : "#7b2cbf";
    ctx.fillRect(part.x, part.y, box, box);
  });

  // Remove glow for food
  ctx.shadowBlur = 0;

  // Food
  ctx.fillStyle = "red";
  ctx.fillRect(food.x, food.y, box, box);

  let headX = snake[0].x;
  let headY = snake[0].y;

  if (direction === "LEFT") headX -= box;
  if (direction === "UP") headY -= box;
  if (direction === "RIGHT") headX += box;
  if (direction === "DOWN") headY += box;

  // LOSE CONDITION
  if (
    headX < 0 || headY < 0 ||
    headX >= canvas.width || headY >= canvas.height ||
    collision({ x: headX, y: headY }, snake)
  ) {
    endGame();
    return;
  }

  if (headX === food.x && headY === food.y) {
    food = {
      x: Math.floor(Math.random() * (canvas.width / box)) * box,
      y: Math.floor(Math.random() * (canvas.height / box)) * box
    };
  } else {
    snake.pop();
  }

  snake.unshift({ x: headX, y: headY });
}

function endGame() {
  clearInterval(game);
  canvas.style.display = "none";

  const randomVideo = loseVideos[Math.floor(Math.random() * loseVideos.length)];
  video.src = randomVideo;
  video.style.display = "block";
  video.play();

  video.onended = () => {
    playButton.style.display = "block";
  };
}
</script>

</body>
</html>
